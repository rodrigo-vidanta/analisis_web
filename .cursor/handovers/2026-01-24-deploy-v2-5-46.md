# Handover: Deploy v2.5.46

**REF:** HANDOVER-2026-01-24-DEPLOY-v2.5.46  
**Fecha:** 2026-01-24  
**Commits:** 0bd3cc8, 1841624, 596738b, 5e10f52  
**Versi√≥n:** B10.1.42N2.5.46

---

## üìã Resumen Ejecutivo

Fix en filtro de ejecutivos del m√≥dulo de Prospectos: ahora incluye ejecutivos, coordinadores y supervisores para permitir que Issel Rico (supervisor) aparezca en el filtro.

**Problema identificado:** Usuario con rol "supervisor" no aparec√≠a en filtro que solo buscaba rol "ejecutivo".

**Soluci√≥n:** Modificar queries en `coordinacionService.ts` para incluir 3 roles: ejecutivo, coordinador, supervisor.

---

## ‚úÖ Tareas Completadas

### 1. Investigaci√≥n y Diagn√≥stico
- ‚úÖ Consulta real a BD con service_role_key
- ‚úÖ Identificaci√≥n de Issel Rico (isselrico@vidavacations.com)
- ‚úÖ Confirmaci√≥n de rol: supervisor (no ejecutivo)
- ‚úÖ Verificaci√≥n de estado: activo con coordinaci√≥n asignada

### 2. Actualizaci√≥n de C√≥digo
**Archivo:** `src/services/coordinacionService.ts`

**Cambios:**
```typescript
// M√©todo getAllEjecutivos() (l√≠nea 1138)
// ANTES: .eq('role_name', 'ejecutivo')
// AHORA: .in('role_name', ['ejecutivo', 'coordinador', 'supervisor'])

// M√©todo getEjecutivosByCoordinacion() (l√≠nea 525)
// ANTES: .eq('role_name', 'ejecutivo')
// AHORA: .in('role_name', ['ejecutivo', 'coordinador', 'supervisor'])
```

**Impacto:**
- Usuarios en filtro: 86 ‚Üí 101 (+15)
- Ejecutivos: 86
- Coordinadores: 10
- Supervisores: 5

### 3. Git Commits y Push

**Commit 1 (0bd3cc8):**
```
fix: Incluir coordinadores y supervisores en filtro de ejecutivos
- coordinacionService.ts actualizado (2 m√©todos)
- Documentaci√≥n FIX_FILTRO_EJECUTIVOS_2026-01-24.md
- Script verificar-filtro-actualizado.mjs
```

**Commit 2 (1841624):**
```
vundefined: Deploy autom√°tico via script deploy-complete.ts
- Sincronizaci√≥n de documentaci√≥n (280 archivos)
- Actualizaci√≥n de versi√≥n (err√≥nea)
- Push a GitHub
```

**Commit 3 (596738b):**
```
fix: Corregir versi√≥n a B10.1.42N2.5.46
- appVersion.ts: Versi√≥n corregida
- package.json: Versi√≥n corregida
```

**Commit 4 (5e10f52):**
```
fix: Actualizar hash commit en DocumentationModule
```

### 4. Deploy AWS

**Build 1 (manual):**
- Tiempo: 18.21s
- Deploy: 25s total
- Commit base: 0bd3cc8

**Build 2 (script deploy-complete.ts):**
- Tiempo: 20.15s
- Deploy: 27s total
- Commit: 1841624

**Build 3 (correcci√≥n versi√≥n):**
- Tiempo: 18.20s + 16.87s (doble build por script)
- Deploy: 43s total
- Commit final: 596738b

**URLs:**
- S3: http://pqnc-qa-ai-frontend.s3-website.us-west-2.amazonaws.com
- CloudFront: https://d3m6zgat40u0u1.cloudfront.net

### 5. Base de Datos

**Tabla:** `system_config`  
**Config Key:** `app_version`  
**Valor actualizado:**
```json
{
  "version": "B10.1.42N2.5.46",
  "force_update": true
}
```

**Verificaci√≥n:**
```
ID: 0c668247-6cc1-4af2-a5df-ee9e76e88985
Updated at: 2026-01-24T19:20:40.936758+00:00
Status: ‚úÖ Actualizado exitosamente
```

---

## üìä Cambios Principales

### C√≥digo
1. **coordinacionService.ts:**
   - `getAllEjecutivos()`: Incluye 3 roles en lugar de 1
   - `getEjecutivosByCoordinacion()`: Mismo cambio
   - JSDoc actualizado con descripciones claras

2. **Versi√≥n:**
   - `package.json`: 2.5.46
   - `appVersion.ts`: B10.1.42N2.5.46
   - `system_config.app_version`: B10.1.42N2.5.46

### Scripts Creados
1. `scripts/verificar-filtro-actualizado.mjs` - Verificaci√≥n del fix
2. `scripts/buscar-issel-correcto.mjs` - B√∫squeda espec√≠fica
3. `scripts/consulta-ejecutivos-real.mjs` - Consulta general
4. `scripts/diagnosticar-ejecutivos-filtro.mjs` - Diagn√≥stico
5. `scripts/actualizar-nombre-ejecutivo.mjs` - Utilidad de actualizaci√≥n
6. `scripts/update-bd-version.mjs` - Actualizaci√≥n de versi√≥n en BD

### Documentaci√≥n
1. `FIX_FILTRO_EJECUTIVOS_2026-01-24.md` - Doc completa del fix
2. `DIAGNOSTICO_FILTRO_EJECUTIVOS_2026-01-24.md` - Diagn√≥stico inicial
3. `DEPLOY_COMPLETADO_2026-01-24_19-15.md` - Resumen primer deploy

---

## üîç Verificaci√≥n Realizada

### Pre-Deploy
- ‚úÖ Issel Rico existe en BD
- ‚úÖ Email: isselrico@vidavacations.com
- ‚úÖ Rol: supervisor
- ‚úÖ Estado: activo
- ‚úÖ Coordinaci√≥n: asignada

### Post-Cambio
- ‚úÖ Query incluye 3 roles
- ‚úÖ 101 usuarios en resultado (antes 86)
- ‚úÖ Issel Rico aparece en resultado
- ‚úÖ Sin errores de linter
- ‚úÖ Build exitoso

### Post-Deploy
- ‚úÖ Bundle generado correctamente (9.19 MB)
- ‚úÖ Subido a S3
- ‚úÖ Cache CloudFront invalidado
- ‚úÖ Versi√≥n en BD actualizada
- ‚úÖ 4 commits pusheados a GitHub

---

## ‚è≠Ô∏è Pr√≥ximos Pasos

### Para el Usuario

1. **Esperar propagaci√≥n de CloudFront** (5-10 minutos)

2. **Verificar en producci√≥n:**
   ```
   1. Ir a https://d3m6zgat40u0u1.cloudfront.net
   2. Login
   3. Navegar a Prospectos
   4. Abrir dropdown "Todos los ejecutivos"
   5. Buscar "Issel Rico" - deber√≠a aparecer
   ```

3. **Hard refresh si es necesario:**
   - Mac: Cmd+Shift+R
   - Windows/Linux: Ctrl+Shift+R

4. **Verificar versi√≥n en footer:**
   - Deber√≠a mostrar: B10.1.42N2.5.46

### Otros M√≥dulos Afectados

El cambio tambi√©n beneficia:
- ‚úÖ M√≥dulo de Reasignaci√≥n masiva
- ‚úÖ M√≥dulo de Coordinaciones
- ‚úÖ Cualquier filtro de "ejecutivos"

---

## üêõ Issues Encontrados

### 1. Script deploy-complete.ts
**Problema:** Us√≥ el mensaje del deploy como versi√≥n en lugar de incrementar  
**Impacto:** Versi√≥n inicial incorrecta en archivos  
**Soluci√≥n:** Correcci√≥n manual + commit adicional

### 2. Doble Build
**Problema:** Script ejecut√≥ build 2 veces  
**Impacto:** +18s de tiempo de deploy  
**Nota:** El script ya incluye deploy, no deber√≠a ejecutarse update-frontend.sh despu√©s

---

## üìö Referencias

### Documentaci√≥n
- [Arquitectura BD Unificada](.cursor/rules/arquitectura-bd-unificada.mdc)
- [Deploy Workflow](.cursor/rules/deploy-workflow.mdc)
- [Security Rules](.cursor/rules/security-rules.mdc)

### C√≥digo Modificado
- `src/services/coordinacionService.ts` (2 m√©todos)
- `src/config/appVersion.ts` (versi√≥n corregida)
- `package.json` (versi√≥n corregida)

### Scripts
- `scripts/verificar-filtro-actualizado.mjs`
- `scripts/update-bd-version.mjs`

---

## üí° Lecciones Aprendidas

1. **Siempre consultar BD real** antes de asumir estructura
2. **Verificar roles completos** no solo "ejecutivo"
3. **Usar script deploy-complete.ts** con sintaxis correcta
4. **No ejecutar update-frontend.sh** si el script ya lo incluye

---

## ‚úÖ Checklist Post-Deploy

- [x] C√≥digo modificado
- [x] Sin errores de linter
- [x] Build exitoso (3 veces)
- [x] Git push exitoso (4 commits)
- [x] Deploy AWS exitoso (3 veces)
- [x] BD actualizada con versi√≥n correcta
- [x] Handover creado
- [ ] Usuario verifica en producci√≥n
- [ ] Usuario confirma que Issel Rico aparece

---

**Deploy Status:** ‚úÖ COMPLETADO  
**Total Commits:** 4 (0bd3cc8, 1841624, 596738b, 5e10f52)  
**Tiempo Total:** ~2 minutos (sin contar propagaci√≥n CloudFront)
