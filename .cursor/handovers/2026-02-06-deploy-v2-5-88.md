# Handover: Deploy v2.5.88

**REF:** HANDOVER-2026-02-06-DEPLOY-v2.5.88  
**Fecha:** 2026-02-06  
**Commit:** a8dcd7f  
**Versión:** B10.1.44N2.5.88

---

## Resumen Ejecutivo

Multi-import de prospectos en WhatsApp: búsqueda por URL de Dynamics CRM + teléfono en paralelo, tutorial animado para copiar URLs, input inline de teléfono para entradas por URL, fix de React keys en AnimatePresence, scrollbars ocultas.

---

## Tareas Completadas

### 1. Multi-Import WhatsApp (ImportWizardModal.tsx)

**Nuevas capacidades:**
- Búsqueda simultánea de 1-5 prospectos (URLs o teléfonos) en paralelo
- Detección automática de tipo de entrada (URL vs teléfono)
- Deduplicación por LeadID (mismo lead por URL + teléfono → se fusionan)
- Validación de permisos por coordinación/propietario
- Envío de plantilla compartida a todos los importados

**Flujo del wizard (4 pasos):**
1. Búsqueda multi-input (textarea, 1-5 líneas, paralelo)
2. Revisión + ingreso de teléfono para URL entries
3. Selección de plantilla con filtros por tags
4. Configuración de variables + envío masivo

### 2. Input de Teléfono para Búsquedas por URL

**Problema:** El endpoint de búsqueda por ID de Dynamics (Power Automate) NO retorna teléfono, pero el workflow de importación N8N SÍ lo requiere para crear suscriptor WhatsApp.

**Solución implementada:**
- Paso 1 → 2: permite avanzar con entradas encontradas aunque no tengan teléfono
- Paso 2: muestra input inline amber para ingresar teléfono manualmente
- Botón "Importar" solo se habilita cuando hay teléfono de 10 dígitos
- Toast descriptivo si intentan importar sin teléfono

**Auto-fill preparado:**
- `searchSingleEntry()` busca campos Telefono, MobilePhone, Telephone1 en la respuesta
- Si el endpoint se actualiza para incluir teléfono, el auto-fill funciona sin cambios

### 3. Tutorial Animado (CrmUrlTutorialModal.tsx - NUEVO)

- Modal con simulación de navegador Dynamics CRM
- 4 pasos: buscar lead → clic → copiar URL → pegar en wizard
- Animaciones: cursor animado, typewriter, ripple de click
- Auto-advance con opción de navegación manual

### 4. Fix React Keys en AnimatePresence

- AnimatePresence tenía dos hijos sin key (motion.div + CrmUrlTutorialModal)
- Movido CrmUrlTutorialModal fuera del AnimatePresence (tiene su propio wrapper)
- Agregado `key="wizard-backdrop"` al motion.div

### 5. Scrollbars Ocultas

- Reemplazado `scrollbar-thin scrollbar-thumb-*` por `scrollbar-hide`
- Scroll funcional sin barras visibles en todo el modal

### 6. Edge Functions Mejoradas

- `dynamics-lead-proxy`: Migrado a Deno.serve() nativo + JWT manual
- `import-contact-proxy`: Detección de body vacío con error 422 COORDINACION_NOT_FOUND

---

## Archivos Modificados

| Archivo | Cambio |
|---------|--------|
| `src/components/chat/ImportWizardModal.tsx` | Multi-import, phone input, fix keys, scrollbar-hide, docs |
| `src/components/chat/CrmUrlTutorialModal.tsx` | **NUEVO** - Tutorial animado CRM URL |
| `src/components/Footer.tsx` | Comentario versión actualizado |
| `src/components/campaigns/plantillas/TemplateTagsSelector.tsx` | Fix React keys duplicadas |
| `src/services/importContactService.ts` | Mejor parsing de errores JSON |
| `supabase/functions/dynamics-lead-proxy/index.ts` | Deno.serve() + JWT manual |
| `supabase/functions/import-contact-proxy/index.ts` | Error 422 body vacío |

---

## Pendientes / Próximos Pasos

### Pendiente de Alejandro Agüero (Power Automate):
1. **Agregar teléfono** al endpoint de búsqueda por ID de Dynamics
   - Cuando se haga: el auto-fill ya está preparado en el código
   - Solo verificar que el campo se llame: Telefono, MobilePhone, o Telephone1
2. **Optimizar búsqueda por teléfono** para reducir de ~70s a tiempos razonables

### Cuando el endpoint devuelva teléfono:
- El input manual de teléfono desaparecerá automáticamente
- El warning amber no se mostrará
- No se necesitan cambios de código adicionales

---

## Git Push
- Commit: a8dcd7f → main
- Push exitoso a origin/main

## Deploy AWS
- Build: 25.36s
- Deploy: 30s total
- S3: http://pqnc-qa-ai-frontend.s3-website.us-west-2.amazonaws.com
- CloudFront: https://d3m6zgat40u0u1.cloudfront.net

## Base de Datos
- Tabla: system_config
- Config Key: app_version
- Versión: B10.1.44N2.5.88
- force_update: true

---

**Deploy Status:** COMPLETADO  
**Verificación:** BD actualizada, Git push OK, AWS deploy OK
