---
alwaysApply: true
---
# Reglas de Uso del MCP N8N

## üìã Informaci√≥n de la Instancia

| Propiedad | Valor |
|-----------|-------|
| **MCP Name** | `N8N` |
| **Versi√≥n** | 1.121.3 |
| **Platform** | Docker (self-hosted) en Railway |
| **Base URL** | `https://primary-dev-d75a.up.railway.app` |
| **API Docs** | `https://primary-dev-d75a.up.railway.app/api/v1/docs/` |
| **Instance ID** | `cd55aa12663cca66c362f6923b086640c04692cadff2ee7c0ba1470b0885fdd7` |
| **License** | Enterprise (production) |
| **Database** | PostgreSQL |
| **Execution Mode** | Scaling (single-main) |
| **Concurrency** | 50 |

## ‚õî REGLAS CR√çTICAS

### 1. NUNCA Hardcodear Credenciales
- Las API Keys est√°n almacenadas en **SystemUI ‚Üí `system_credentials`**
- NUNCA incluir API keys en c√≥digo fuente
- Para el MCP: token en `~/.cursor/mcp.json` (NO compartir)
- Para el c√≥digo: usar `credentialsService.getN8NCredentials()`

**Credenciales disponibles en BD:**
| service_name | credential_key | Uso |
|--------------|----------------|-----|
| N8N | API_KEY | API REST p√∫blica |
| N8N | MCP_API_KEY | Conexi√≥n MCP Server |
| N8N | BASE_URL | URL de la instancia |

```typescript
// Ejemplo de uso en c√≥digo
import { credentialsService } from '../services/credentialsService';
const { apiKey, baseUrl } = await credentialsService.getN8NCredentials();
```

### 2. Operaciones de Alto Riesgo
- ‚ö†Ô∏è `DELETE /workflows/{id}` - Elimina workflow permanentemente
- ‚ö†Ô∏è `POST /workflows/{id}/deactivate` - Detiene workflow en producci√≥n
- ‚ö†Ô∏è `DELETE /executions/{id}` - Elimina historial de ejecuci√≥n
- **SIEMPRE** confirmar con el usuario antes de ejecutar estas operaciones

### 3. Workflows en Producci√≥n
Los siguientes workflows est√°n ACTIVOS en producci√≥n:
- `Guardrail agentic logic [PROD]` - ID: Q5pWOsixILUmnWP3
- `Logica de llamadas programadas [PROD]` - ID: HYRGSVN86YY64pBS
- `VAPI-Natalia_transfer_tool [PROD]` - ID: qpk8xsMI50IWltFV
- `[api]-whatsapp-templates-gestion` - ID: 99xohF9xOZT2nIe5
- `[api]-whatsapp-templates-envio-v2` - ID: pZSsb89s4ZqN8Pl6

**NO modificar sin autorizaci√≥n expl√≠cita.**

## üîß Herramientas Disponibles

### Workflows

| Herramienta | Descripci√≥n | Riesgo |
|-------------|-------------|--------|
| `mcp_N8N_search_workflows` | Buscar workflows con filtros | üü¢ Bajo |
| `mcp_N8N_get_workflow_details` | Obtener detalles de un workflow | üü¢ Bajo |
| `mcp_N8N_execute_workflow` | Ejecutar un workflow | üü° Medio |

### Ejecuciones (No disponibles actualmente v√≠a MCP)
Para operaciones de ejecuciones, usar la API REST directamente o el Dashboard de N8N.

## üìä Capacidades del API (Referencia)

### Endpoints Disponibles

#### User Management
- `GET /users` - Listar usuarios
- `POST /users` - Crear usuarios
- `GET /users/{id}` - Obtener usuario
- `DELETE /users/{id}` - Eliminar usuario
- `PATCH /users/{id}/role` - Cambiar rol

#### Workflows
- `GET /workflows` - Listar workflows
- `POST /workflows` - Crear workflow
- `GET /workflows/{id}` - Obtener workflow
- `PUT /workflows/{id}` - Actualizar workflow
- `DELETE /workflows/{id}` - Eliminar workflow
- `POST /workflows/{id}/activate` - Activar workflow
- `POST /workflows/{id}/deactivate` - Desactivar workflow
- `PUT /workflows/{id}/transfer` - Transferir a otro proyecto
- `GET /workflows/{id}/tags` - Obtener tags
- `PUT /workflows/{id}/tags` - Actualizar tags

#### Executions
- `GET /executions` - Listar ejecuciones
- `GET /executions/{id}` - Obtener ejecuci√≥n
- `DELETE /executions/{id}` - Eliminar ejecuci√≥n
- `POST /executions/{id}/retry` - Reintentar ejecuci√≥n

#### Credentials
- `POST /credentials` - Crear credencial
- `DELETE /credentials/{id}` - Eliminar credencial
- `GET /credentials/schema/{type}` - Ver esquema de credencial
- `PUT /credentials/{id}/transfer` - Transferir credencial

#### Tags
- `POST /tags` - Crear tag
- `GET /tags` - Listar tags
- `GET /tags/{id}` - Obtener tag
- `PUT /tags/{id}` - Actualizar tag
- `DELETE /tags/{id}` - Eliminar tag

#### Variables
- `POST /variables` - Crear variable
- `GET /variables` - Listar variables
- `PUT /variables/{id}` - Actualizar variable
- `DELETE /variables/{id}` - Eliminar variable

#### Projects
- `POST /projects` - Crear proyecto
- `GET /projects` - Listar proyectos
- `PUT /projects/{projectId}` - Actualizar proyecto
- `DELETE /projects/{projectId}` - Eliminar proyecto
- `POST /projects/{projectId}/users` - Agregar usuarios
- `DELETE /projects/{projectId}/users/{userId}` - Remover usuario
- `PATCH /projects/{projectId}/users/{userId}` - Cambiar rol usuario

#### Source Control
- `POST /source-control/pull` - Pull desde repositorio remoto

#### Audit
- `POST /audit` - Generar auditor√≠a de seguridad

## üìÅ Archivos Relacionados

| Archivo | Descripci√≥n | En Git |
|---------|-------------|--------|
| `~/.cursor/mcp.json` | Configuraci√≥n MCP con token | ‚ùå No |
| `.cursor/rules/n8n-rules.mdc` | Este archivo de reglas | ‚úÖ S√≠ |
| `docs/N8N_MCP_CATALOG.md` | Documentaci√≥n completa | ‚úÖ S√≠ |
| `docs/N8N_WORKFLOWS_INDEX.md` | √çndice de workflows | ‚úÖ S√≠ |
| `src/services/credentialsService.ts` | Servicio para obtener credenciales de BD | ‚úÖ S√≠ |

### üìä Tabla de Credenciales (SystemUI)
```sql
-- Ver todas las credenciales de N8N
SELECT module_name, token_key, description, is_active 
FROM api_auth_tokens 
WHERE module_name LIKE 'N8N%' AND is_active = true;
```

**Credenciales en BD (12 activas):**
- N8N: API_KEY, MCP_API_KEY, BASE_URL
- N8N Webhooks: DYNAMICS_TOKEN, GET_LEAD_URL, REASIGNAR_URL
- Llamadas Programadas: manual_call_auth
- Mensajes WhatsApp: send_message_auth
- Pausar Bot: pause_bot_auth
- Media WhatsApp: media_url_auth
- Plantillas WhatsApp: whatsapp_templates_auth
- Broadcast WhatsApp: broadcast_auth

## üìù Flujo de Trabajo Recomendado

1. **Antes de modificar workflows:**
   - Usar `search_workflows` para listar
   - Usar `get_workflow_details` para ver estructura
   - Verificar si est√° marcado como [PROD]

2. **Para ejecutar workflows:**
   - Verificar descripci√≥n del workflow
   - Revisar trigger type (webhook, form, chat)
   - Preparar inputs seg√∫n esquema

3. **Para debugging:**
   - Consultar ejecuciones recientes
   - Revisar logs de errores
   - Verificar conexiones de nodos

## ‚ö†Ô∏è Advertencias

1. **Producci√≥n activa**: Esta instancia maneja comunicaciones reales
2. **Sin rollback**: Los cambios a workflows son inmediatos
3. **Costos de API**: Cada ejecuci√≥n consume recursos (LLMs, APIs externas)
4. **Rate Limits**: Respetar l√≠mites de concurrencia (50)

## üîê Seguridad

- Token de API con permisos de MCP Server
- Conexi√≥n segura v√≠a HTTPS
- Autenticaci√≥n Bearer token requerida
- NUNCA exponer el token en logs o c√≥digo

---

**√öltima actualizaci√≥n:** 2025-01-07
**Documentaci√≥n completa:** `docs/N8N_MCP_CATALOG.md`
