# üî¥ REPORTE DE PENTESTING PROFESIONAL
## ai.vidavacations.com

**Fecha:** 17 Enero 2026  
**Metodolog√≠a:** OWASP Testing Guide v4 + PTES  
**Tipo:** Black-box (sin credenciales ni acceso previo)  
**Pentester:** Senior Security Analyst  

---

## üìä RESUMEN EJECUTIVO

| Severidad | Cantidad | Estado |
|-----------|----------|--------|
| üî¥ **Cr√≠tica** | 0 | ‚úÖ |
| üü† **Alta** | 0 | ‚úÖ |
| üü° **Media** | 2 | ‚ö†Ô∏è Pendiente |
| üü¢ **Baja** | 4 | ‚ö†Ô∏è Pendiente |
| ‚ÑπÔ∏è **Info** | 3 | Documentado |

**Veredicto General:** üü¢ **SEGURO** - El sistema muestra una postura de seguridad s√≥lida con controles bien implementados.

---

## üèóÔ∏è ARQUITECTURA IDENTIFICADA

### Infraestructura
| Componente | Tecnolog√≠a | Notas |
|------------|------------|-------|
| CDN | CloudFront | POP: QRO51-P6 (Quer√©taro, M√©xico) |
| Storage | Amazon S3 | Hosting est√°tico |
| SSL | Amazon RSA 2048 M04 | V√°lido hasta Dic 2026 |
| Backend | Supabase | 3 proyectos identificados |
| Workflows | N8N en Railway | primary-dev-d75a.up.railway.app |
| Voice AI | VAPI | WebSockets wss://*.vapi.ai |

### Proyectos Supabase Identificados
1. `glsmifhkoaifvaegsozd` - Principal (PQNC_AI)
2. `hmmfuhqgvsehkizlfzga` - Secundario (PQNC_QA)
3. `dffuwdzybhypxfzrmdcz` - LOGMONITOR

### APIs Externas
- ElevenLabs (Text-to-Speech)
- Mapbox (Mapas)
- IPIFY (IP Lookup)
- MyMemory (Traducci√≥n)

---

## ‚úÖ CONTROLES DE SEGURIDAD VERIFICADOS

### Headers HTTP
| Header | Valor | Estado |
|--------|-------|--------|
| X-XSS-Protection | 1; mode=block | ‚úÖ Correcto |
| X-Frame-Options | DENY | ‚úÖ Correcto |
| Referrer-Policy | strict-origin-when-cross-origin | ‚úÖ Correcto |
| HSTS | max-age=31536000; includeSubDomains | ‚úÖ Correcto |
| CSP | Configurado | ‚ö†Ô∏è Ver hallazgos |

### Autenticaci√≥n
| Prueba | Resultado |
|--------|-----------|
| SignUp p√∫blico | ‚ùå Deshabilitado (signup_disabled) |
| Enumeraci√≥n de usuarios | ‚ùå No posible |
| Password reset enumeration | ‚ùå No revela existencia |
| Brute force protection | ‚úÖ Rate limiting configurado |

### Row Level Security (RLS)
| Tabla | Estado |
|-------|--------|
| auth_users | ‚úÖ BLOQUEADO |
| auth_sessions | ‚úÖ BLOQUEADO |
| api_auth_tokens | ‚úÖ BLOQUEADO |
| prospectos | ‚úÖ BLOQUEADO |
| llamadas_ventas | ‚úÖ BLOQUEADO |
| mensajes_whatsapp | ‚úÖ BLOQUEADO |
| system_config | ‚úÖ BLOQUEADO |
| coordinaciones | ‚úÖ BLOQUEADO |
| auth_roles | ‚úÖ BLOQUEADO |

### Vistas Sensibles
| Vista | Estado |
|-------|--------|
| auth_users_safe | ‚úÖ BLOQUEADO |
| user_profiles_v2 | ‚úÖ BLOQUEADO |
| live_monitor_view | ‚úÖ BLOQUEADO |
| api_auth_tokens_safe | ‚úÖ BLOQUEADO |

### Funciones RPC
| Funci√≥n | Estado |
|---------|--------|
| get_credential_value | ‚úÖ permission denied |
| security_status_report | ‚úÖ permission denied |
| test_exec_sql_capabilities | ‚úÖ permission denied |
| check_account_locked | ‚úÖ permission denied |
| create_user_with_role | ‚úÖ No accesible |

### Edge Functions
| Funci√≥n | Sin Auth | Con anon_key |
|---------|----------|---------------|
| multi-db-proxy | 401 | "Authentication required" |
| send-message-proxy | 401 | "Authentication required" |
| pause-bot-proxy | 401 | "Authentication required" |
| broadcast-proxy | 403 | 403 |

### Webhooks N8N
| Webhook | Estado |
|---------|--------|
| /webhook/lead-info | ‚úÖ "Authorization data is wrong!" |
| /webhook/reasignar-prospecto | ‚úÖ "Authorization data is wrong!" |
| /webhook/auth_server | ‚ö†Ô∏è Honeypot/Sistema MFA complejo |

### Defensas Especiales
- ‚úÖ **Honeypot JWT** detectado ("hackeame_si_puedes" con service_role falso)
- ‚úÖ **Tablas p√∫blicas** solo contienen datos de UI (logos, temas)

---

## ‚ö†Ô∏è VULNERABILIDADES ENCONTRADAS

### üü° MEDIA: Information Disclosure - Schema de BD Expuesto

**Severidad:** Media  
**CVSS:** 5.3 (Medium)  
**Ubicaci√≥n:** `https://glsmifhkoaifvaegsozd.supabase.co/rest/v1/`

**Descripci√≥n:**  
El endpoint de OpenAPI/Swagger de PostgREST expone el schema completo de la base de datos, incluyendo:
- 30+ nombres de tablas
- 97+ funciones RPC
- Estructura de columnas (incluyendo `password_hash`, `token_value`, `api_key`)

**Evidencia:**
```bash
curl -s -H "apikey: $ANON_KEY" "$SUPABASE/rest/v1/" | wc -l
# Resultado: 17,710 l√≠neas de schema
```

**Tablas reveladas (muestra):**
- auth_users, auth_sessions, api_auth_tokens
- prospectos, llamadas_ventas, mensajes_whatsapp
- content_moderation_warnings, bot_pause_status

**RPCs reveladas (muestra):**
- get_credential_value
- create_user_with_role
- change_user_password
- security_status_report
- exec_sql_insert_company

**Impacto:**
- Atacante puede mapear toda la estructura de la BD
- Facilita ataques dirigidos a funciones espec√≠ficas
- Revela nombres de columnas sensibles

**Recomendaci√≥n:**
1. Configurar PostgREST para no exponer el endpoint ra√≠z
2. O implementar proxy que filtre la respuesta

---

### üü° MEDIA: GraphQL Schema Expuesto

**Severidad:** Media  
**CVSS:** 5.3 (Medium)  
**Ubicaci√≥n:** `https://glsmifhkoaifvaegsozd.supabase.co/graphql/v1`

**Descripci√≥n:**  
El endpoint GraphQL permite introspecci√≥n del schema completo.

**Evidencia:**
```bash
curl -X POST "$SUPABASE/graphql/v1" \
  -H "apikey: $ANON_KEY" \
  -d '{"query":"{ __schema { types { name } } }"}'
# Devuelve lista completa de tipos
```

**Recomendaci√≥n:**
- Deshabilitar introspecci√≥n en producci√≥n
- O limitar a usuarios autenticados

---

### üü¢ BAJA: CORS Permisivo

**Severidad:** Baja  
**CVSS:** 3.7 (Low)  
**Ubicaci√≥n:** Headers de respuesta de Supabase

**Descripci√≥n:**  
El header CORS permite cualquier origen: `access-control-allow-origin: *`

**Evidencia:**
```bash
curl -sI -X OPTIONS "$SUPABASE/rest/v1/" \
  -H "Origin: https://malicious-site.com"
# Devuelve: access-control-allow-origin: *
```

**Impacto:**
- Cualquier sitio web puede hacer requests a la API
- Mitigado por: RLS bloquea datos sensibles

**Recomendaci√≥n:**
- Configurar CORS para permitir solo or√≠genes espec√≠ficos
- Lista blanca: `ai.vidavacations.com`, `*.supabase.co`

---

### üü¢ BAJA: CSP con 'unsafe-inline' y 'unsafe-eval'

**Severidad:** Baja  
**CVSS:** 3.1 (Low)  
**Ubicaci√≥n:** Header Content-Security-Policy

**Descripci√≥n:**  
La pol√≠tica CSP incluye directivas permisivas:
```
script-src 'self' 'unsafe-inline' 'unsafe-eval' ...
```

**Impacto:**
- Reduce efectividad de protecci√≥n XSS del CSP
- Sin embargo, no se encontr√≥ XSS explotable

**Recomendaci√≥n:**
- Migrar a nonces o hashes para scripts inline
- Eliminar 'unsafe-eval' si no es necesario

---

### üü¢ BAJA: Mensajes de Error Reveladores en RPC

**Severidad:** Baja  
**CVSS:** 3.1 (Low)  
**Ubicaci√≥n:** Respuestas de error de PostgREST

**Descripci√≥n:**  
Los errores de RPC revelan nombres de funciones existentes:

```json
{
  "hint": "Perhaps you meant to call the function public.exec_sql_insert_company",
  "message": "Could not find the function public.exec_sql(sql)..."
}
```

**Recomendaci√≥n:**
- Configurar mensajes de error gen√©ricos
- O deshabilitar hints en producci√≥n

---

### üü¢ BAJA: Webhooks y Edge Functions Expuestos en Bundle

**Severidad:** Baja (Info)  
**Ubicaci√≥n:** Bundle JavaScript

**Descripci√≥n:**  
El c√≥digo JS revela 16 Edge Functions y 4 webhooks:

**Edge Functions:**
- multi-db-proxy, send-message-proxy, pause-bot-proxy
- broadcast-proxy, dynamics-lead-proxy, paraphrase-proxy
- whatsapp-templates-proxy, etc.

**Webhooks N8N:**
- /webhook/auth_server
- /webhook/error-log
- /webhook/lead-info
- /webhook/reasignar-prospecto

**Impacto:**
- Permite a atacante conocer superficie de ataque
- PERO: Todos est√°n protegidos con autenticaci√≥n

**Recomendaci√≥n:**
- Considerar ofuscaci√≥n de nombres
- O usar IDs aleatorios en lugar de nombres descriptivos

---

## ‚ÑπÔ∏è INFORMACI√ìN ADICIONAL

### URLs Identificadas
| Tipo | URL |
|------|-----|
| Supabase Principal | glsmifhkoaifvaegsozd.supabase.co |
| N8N Railway | primary-dev-d75a.up.railway.app |
| Storage P√∫blico | hmmfuhqgvsehkizlfzga.supabase.co/storage/v1/object/public/ |

### JWTs Analizados
| Proyecto | Rol | Estado |
|----------|-----|--------|
| glsmifhkoaifvaegsozd | anon | ‚úÖ Esperado |
| hmmfuhqgvsehkizlfzga | anon | ‚úÖ Esperado |
| dffuwdzybhypxfzrmdcz | anon | ‚úÖ Esperado |
| hackeame_si_puedes | service_role | üéØ HONEYPOT |

### Tablas P√∫blicas (Seguras)
Solo exponen datos de UI:
- `system_config_public` - Logo, nombre de app
- `log_config_public` - Configuraci√≥n de logs (enabled: true)
- `app_themes_public` - Colores de temas

---

## üõ°Ô∏è INTENTOS DE EXPLOTACI√ìN FALLIDOS

| Ataque | Resultado |
|--------|-----------|
| SQL Injection en login | ‚ùå No vulnerable |
| XSS en campos de formulario | ‚ùå Input sanitizado |
| Bypass de autenticaci√≥n JWT | ‚ùå Bloqueado |
| Acceso a tablas sin auth | ‚ùå RLS activo |
| Llamada a webhooks sin auth | ‚ùå 403 Forbidden |
| Creaci√≥n de usuarios | ‚ùå signup_disabled |
| Enumeraci√≥n de emails | ‚ùå No revela info |
| Path traversal en Storage | ‚ùå Bloqueado |
| RPC exec_sql | ‚ùå permission denied |

---

## üìã RECOMENDACIONES PRIORIZADAS

### Prioridad Alta (Corregir en 1-2 semanas)
| # | Acci√≥n | Esfuerzo |
|---|--------|----------|
| 1 | Ocultar schema de PostgREST (endpoint `/`) | Bajo |
| 2 | Deshabilitar introspecci√≥n GraphQL | Bajo |

### Prioridad Media (Corregir en 1 mes)
| # | Acci√≥n | Esfuerzo |
|---|--------|----------|
| 3 | Restringir CORS a or√≠genes espec√≠ficos | Medio |
| 4 | Configurar mensajes de error gen√©ricos | Medio |

### Prioridad Baja (Mejoras opcionales)
| # | Acci√≥n | Esfuerzo |
|---|--------|----------|
| 5 | Migrar CSP a nonces (eliminar unsafe-inline) | Alto |
| 6 | Ofuscar nombres de webhooks/endpoints | Medio |

---

## ‚úÖ BUENAS PR√ÅCTICAS DETECTADAS

1. ‚úÖ **Honeypot JWT** - Excelente defensa activa
2. ‚úÖ **RLS habilitado** - Todas las tablas sensibles protegidas
3. ‚úÖ **SignUp deshabilitado** - Previene registro no autorizado
4. ‚úÖ **Edge Functions protegidas** - Requieren usuario autenticado
5. ‚úÖ **Webhooks protegidos** - Requieren Authorization header
6. ‚úÖ **Tablas p√∫blicas** - Solo contienen datos de UI
7. ‚úÖ **No hay service_role keys** - Solo anon_keys en bundle
8. ‚úÖ **Headers de seguridad** - HSTS, X-Frame-Options, etc.

---

## üìä M√âTRICAS DEL PENTESTING

| M√©trica | Valor |
|---------|-------|
| Duraci√≥n | ~45 minutos |
| Endpoints probados | 50+ |
| Payloads XSS/SQLi | 15+ |
| Edge Functions | 16 |
| Webhooks | 4 |
| Tablas RLS | 9 |
| Vistas | 5 |
| RPCs | 10+ |

---

## üîê CONCLUSI√ìN

El sitio **ai.vidavacations.com** presenta una **postura de seguridad robusta** con controles bien implementados:

- **Autenticaci√≥n:** S√≥lida, sin bypass posible
- **Autorizaci√≥n:** RLS efectivo en todas las tablas sensibles
- **Protecci√≥n de endpoints:** Edge Functions y webhooks requieren auth
- **Headers HTTP:** Correctamente configurados
- **Defensa activa:** Honeypot JWT implementado

Las vulnerabilidades encontradas son de **severidad baja a media** y principalmente relacionadas con **information disclosure** que, aunque expone estructura, no permite acceso a datos reales.

**Clasificaci√≥n de Seguridad:** üü¢ **8.5/10**

---

**Reporte generado:** 17 Enero 2026  
**Pr√≥ximo pentesting recomendado:** Abril 2026

