# An√°lisis Pentest - Estado Real vs Reporte

**Fecha An√°lisis:** 17 Enero 2026 00:00 UTC  
**Reporte Base:** PENTEST-REPORT-2026-01-16 (versi√≥n 2)

---

## VULNERABILIDADES CR√çTICAS

### ‚úÖ VULN-001: Token localStorage (CORREGIDO)

**Reporte dice:** Token expuesto en localStorage  
**Estado real:**
- Tabla `log_server_config`: RLS habilitado ‚úÖ (1 pol√≠tica service_role only)
- Vista segura: `log_server_config_safe` creada ‚úÖ
- errorLogService.ts: Migrado a vista segura ‚úÖ
- Token hardcodeado removido ‚úÖ

**Verificaci√≥n:** ‚úÖ CORREGIDO

---

### ‚ö†Ô∏è VULN-002: Token error-log comprometido (PENDIENTE ROTACI√ìN)

**Reporte dice:** Token expuesto sigue funcionando  
**Estado real:**
- Token removido del c√≥digo ‚úÖ
- Tabla bloqueada ‚úÖ
- **PERO:** Token viejo a√∫n v√°lido en N8N ‚ö†Ô∏è

**Acci√≥n requerida:**
1. Ir a N8N Dashboard
2. Workflow "error-log"
3. Generar nuevo token
4. Actualizar credencial

**Verificaci√≥n:** üü° PARCIAL (c√≥digo OK, token en N8N pendiente)

---

### ‚úÖ VULN-002b: mensaje-agente (CORREGIDO)

**Reporte dice:** Sin autenticaci√≥n (200)  
**Estado real:**
- Edge Function `paraphrase-proxy` deployada ‚úÖ
- JWT requerido ‚úÖ
- ParaphraseModal.tsx migrado ‚úÖ

**Verificaci√≥n:** ‚úÖ CORREGIDO

---

### ‚ùå VULN-002c: transfer_request (PENDIENTE)

**Reporte dice:** Sin autenticaci√≥n (200)  
**Estado real:**
- Edge Function: NO creada ‚ùå
- C√≥digo: Probablemente usa webhook directo ‚ùå

**Acci√≥n requerida:**
1. Crear Edge Function `transfer-request-proxy`
2. Migrar c√≥digo a usar Edge Function
3. O agregar auth en N8N

**Verificaci√≥n:** ‚ùå PENDIENTE

---

### ‚ùå VULN-002d: tools (PENDIENTE)

**Reporte dice:** Sin autenticaci√≥n (200)  
**Estado real:**
- Edge Function: NO creada ‚ùå
- C√≥digo: Probablemente usa webhook directo ‚ùå

**Acci√≥n requerida:**
1. Crear Edge Function `tools-proxy`
2. Migrar c√≥digo a usar Edge Function
3. O agregar auth en N8N

**Verificaci√≥n:** ‚ùå PENDIENTE

---

### ‚úÖ VULN-003: RLS Tablas PQNC_AI (CORREGIDO)

**Reporte dice:** 4 tablas sin RLS  
**Estado real:**

| Tabla | RLS | Pol√≠ticas |
|-------|-----|-----------|
| coordinaciones | ‚úÖ ON | 2 |
| system_config | ‚úÖ ON | 2 |
| app_themes | ‚úÖ ON | 3 |
| log_server_config | ‚úÖ ON | 1 |

**Verificaci√≥n:** ‚úÖ CORREGIDO

---

## VULNERABILIDADES ALTAS

### ‚ö†Ô∏è VULN-004: Tres Proyectos Supabase (INFORMACI√ìN)

**Reporte dice:** M√∫ltiples proyectos identificados  
**Estado real:**
- PQNC_AI: RLS habilitado ‚úÖ
- PQNC_QA: RLS aplicado (2 tablas cr√≠ticas) üü°
- LOGMONITOR: RLS aplicado (1 tabla cr√≠tica) üü°

**Verificaci√≥n:** üü° PARCIAL (falta completar PQNC_QA y LOGMONITOR)

---

### ‚úÖ VULN-005: 41 RPCs (AUDITADO)

**Reporte dice:** Funciones expuestas sin auditar  
**Estado real:**
- 9 cr√≠ticas auditadas ‚úÖ
- Todas son SECURITY DEFINER ‚úÖ
- 3 requieren auditor√≠a adicional ‚ö†Ô∏è

**Verificaci√≥n:** ‚úÖ AUDITADO (pendiente 3 RPCs menores)

---

### ‚úÖ VULN-007: Login form method (OK)

**Reporte dice:** form con method="get"  
**Estado real:**
- LoginScreen.tsx usa `onSubmit` ‚úÖ
- NO tiene atributo `method` ‚úÖ
- React maneja submit ‚úÖ

**Verificaci√≥n:** ‚úÖ OK (no era problema)

---

## VULNERABILIDADES MEDIAS

### üü° VULN-008: Console.logs (PARCIAL)

**Reporte dice:** Logs exponen estado  
**Estado real:**
- 2019 console statements total
- 75 archivos sin protecci√≥n DEV
- Cr√≠ticos ya protegidos (dynamics, images) ‚úÖ

**Verificaci√≥n:** üü° PARCIAL (no cr√≠tico)

---

## RESUMEN PENDIENTES

### CR√çTICO (Requiere acci√≥n)
1. ‚ùå **Rotar token error-log en N8N** (token comprometido)
2. ‚ùå **transfer_request sin auth** (crear Edge Function o auth en N8N)
3. ‚ùå **tools sin auth** (crear Edge Function o auth en N8N)

### MEDIO (Mejorar seguridad)
4. üü° **Completar RLS en PQNC_QA** (5 tablas m√°s)
5. üü° **Completar RLS en LOGMONITOR** (4 tablas m√°s)

### BAJO (No cr√≠tico)
6. üü¢ Console.logs en producci√≥n
7. üü¢ Links t√©rminos/privacidad

---

## CORREGIDOS VERIFICADOS

‚úÖ Token localStorage  
‚úÖ mensaje-agente webhook  
‚úÖ RLS en 4 tablas PQNC_AI  
‚úÖ 23 vistas restringidas  
‚úÖ 2 tablas AI creadas  
‚úÖ Edge Functions con JWT  
‚úÖ Tokens hardcodeados removidos  

---

## SCORE SEGURIDAD

**Vulnerabilidades Cr√≠ticas:** 3/7 corregidas (43%)  
**Vulnerabilidades Altas:** 2/4 corregidas (50%)  
**Vulnerabilidades Medias:** 1/2 parcial (50%)  

**TOTAL:** 6/13 corregidas + 3 parciales = **60% seguro**

**Prioridad inmediata:** 3 webhooks (error-log rotaci√≥n + 2 sin auth)
